{% extends "base.html" %}

{% block content %}
<div class="container-fluid mt-4">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h2 class="mb-0">
                        <i class="fas fa-user me-2"></i> Student Profile
                    </h2>
                    <p class="text-muted mb-0">Detailed view of student information and recommendations</p>
                </div>
                <div class="d-flex gap-2">
                    <a href="/students" class="btn btn-outline-secondary">
                        <i class="fas fa-arrow-left me-2"></i>Back to List
                    </a>
                    <button class="btn btn-outline-primary" onclick="refreshPage()">
                        <i class="fas fa-sync-alt me-2"></i>Refresh
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Student Information -->
        <div class="col-lg-4">
            <div class="card mb-4">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-user-circle me-2"></i> Personal Information
                    </h5>
                </div>
                <div class="card-body">
                    <div class="text-center mb-3">
                        <div class="avatar-lg bg-primary text-white rounded-circle d-inline-flex align-items-center justify-content-center">
                            {{ student.name[0].upper() }}
                        </div>
                        <h4 class="mt-2 mb-0">{{ student.name }}</h4>
                        <p class="text-muted">Student ID: #{{ student.id }}</p>
                    </div>
                    
                    <div class="student-info">
                        <div class="info-item">
                            <strong>Mobile Number:</strong>
                            <span class="text-muted">{{ student.mobile_number }}</span>
                        </div>
                        {% if student.email %}
                        <div class="info-item">
                            <strong>Email:</strong>
                            <span class="text-muted">{{ student.email }}</span>
                        </div>
                        {% endif %}
                        <div class="info-item">
                            <strong>Education Type:</strong>
                            <span class="badge bg-info">{{ student.education_type }}</span>
                        </div>
                        <div class="info-item">
                            <strong>Preferred Field:</strong>
                            <span class="badge bg-success">{{ student.preferred_field }}</span>
                        </div>
                        <div class="info-item">
                            <strong>Learning Mode:</strong>
                            <span class="badge bg-warning">{{ student.preferred_mode }}</span>
                        </div>
                        <div class="info-item">
                            <strong>Budget:</strong>
                            <span class="text-muted">{{ student.budget }} Lakhs/year</span>
                        </div>
                        <div class="info-item">
                            <strong>Location:</strong>
                            <span class="text-muted">{{ student.location_preference }}</span>
                        </div>
                        <div class="info-item">
                            <strong>Registered:</strong>
                            <span class="text-muted">{{ student.created_at[:19] }}</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Academic Performance -->
            <div class="card mb-4">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-graduation-cap me-2"></i> Academic Performance
                    </h5>
                </div>
                <div class="card-body">
                    <div class="performance-chart">
                        <div class="score-item">
                            <div class="d-flex justify-content-between align-items-center">
                                <span>SSC Percentage</span>
                                <span class="badge bg-primary">{{ student.ssc_percent }}%</span>
                            </div>
                            <div class="progress mt-1">
                                <div class="progress-bar bg-primary" style="width: {{ student.ssc_percent }}%"></div>
                            </div>
                        </div>
                        
                        {% if student.hsc_percent %}
                        <div class="score-item">
                            <div class="d-flex justify-content-between align-items-center">
                                <span>HSC Percentage</span>
                                <span class="badge bg-info">{{ student.hsc_percent }}%</span>
                            </div>
                            <div class="progress mt-1">
                                <div class="progress-bar bg-info" style="width: {{ student.hsc_percent }}%"></div>
                            </div>
                        </div>
                        {% endif %}
                        
                        {% if student.diploma_percent %}
                        <div class="score-item">
                            <div class="d-flex justify-content-between align-items-center">
                                <span>Diploma Percentage</span>
                                <span class="badge bg-warning">{{ student.diploma_percent }}%</span>
                            </div>
                            <div class="progress mt-1">
                                <div class="progress-bar bg-warning" style="width: {{ student.diploma_percent }}%"></div>
                            </div>
                        </div>
                        {% endif %}
                        
                        <div class="score-item">
                            <div class="d-flex justify-content-between align-items-center">
                                <span>Average Score</span>
                                {% set avg_score = (student.ssc_percent + (student.hsc_percent or 0) + (student.diploma_percent or 0)) / 3 %}
                                {% if avg_score >= 80 %}
                                    <span class="badge bg-success">{{ "%.1f"|format(avg_score) }}%</span>
                                {% elif avg_score >= 60 %}
                                    <span class="badge bg-warning">{{ "%.1f"|format(avg_score) }}%</span>
                                {% else %}
                                    <span class="badge bg-danger">{{ "%.1f"|format(avg_score) }}%</span>
                                {% endif %}
                            </div>
                            <div class="progress mt-1">
                                <div class="progress-bar bg-success" style="width: {{ avg_score }}%"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Interests -->
            <div class="card">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-heart me-2"></i> Areas of Interest
                    </h5>
                </div>
                <div class="card-body">
                    {% if student.interests %}
                    <div class="interests-container">
                        {% for interest in student.interests %}
                        <span class="badge bg-light text-dark me-1 mb-1">{{ interest }}</span>
                        {% endfor %}
                    </div>
                    {% else %}
                    <p class="text-muted">No interests specified</p>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Recommendations -->
        <div class="col-lg-8">
            <div class="card">
                <div class="card-header bg-secondary text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-robot me-2"></i> AI Recommendations
                        <span class="badge bg-light text-dark ms-2">{{ recommendations|length }}</span>
                    </h5>
                </div>
                <div class="card-body">
                    {% if recommendations %}
                    <div class="recommendations-list">
                        {% for recommendation in recommendations %}
                        <div class="recommendation-item mb-4">
                            <div class="d-flex justify-content-between align-items-start mb-3">
                                <div>
                                    <h6 class="mb-1">Recommendation #{{ recommendation.id }}</h6>
                                    <small class="text-muted">Generated on {{ recommendation.created_at[:19] }}</small>
                                </div>
                                <div>
                                    {% if recommendation.confidence_score %}
                                    <span class="badge bg-primary">
                                        Confidence: {{ "%.1f"|format(recommendation.confidence_score * 100) }}%
                                    </span>
                                    {% endif %}
                                </div>
                            </div>
                            
                            <div class="recommendation-content">
                                <div class="mb-3">
                                    <h6 class="text-primary">Recommended Pathway</h6>
                                    <p class="mb-0">{{ recommendation.recommended_pathway }}</p>
                                </div>
                                
                                <div class="mb-3">
                                    <h6 class="text-secondary">Reasoning</h6>
                                    <p class="text-muted">{{ recommendation.reasoning }}</p>
                                </div>
                                
                                {% if recommendation.career_opportunities %}
                                <div class="mb-3">
                                    <h6 class="text-secondary">Career Opportunities</h6>
                                    <div class="row">
                                        {% for opportunity in recommendation.career_opportunities %}
                                        <div class="col-md-6 mb-2">
                                            <div class="card border-0 bg-light">
                                                <div class="card-body py-2">
                                                    <i class="fas fa-star text-warning me-2"></i>
                                                    {% if opportunity.title %}
                                                        <strong>{{ opportunity.title }}</strong>
                                                        {% if opportunity.description %}
                                                            <br><small class="text-muted">{{ opportunity.description }}</small>
                                                        {% endif %}
                                                    {% else %}
                                                        {{ opportunity }}
                                                    {% endif %}
                                                </div>
                                            </div>
                                        </div>
                                        {% endfor %}
                                    </div>
                                </div>
                                {% endif %}
                                
                                {% if recommendation.suggested_courses %}
                                <div class="mb-3">
                                    <h6 class="text-secondary">Suggested Courses</h6>
                                    <div class="list-group">
                                        {% for course in recommendation.suggested_courses %}
                                        <div class="list-group-item border-0 bg-light mb-1">
                                            <i class="fas fa-graduation-cap text-primary me-2"></i>
                                            {% if course.course_name %}
                                                <strong>{{ course.course_name }}</strong>
                                                {% if course.level %}
                                                    <span class="badge bg-info ms-2">{{ course.level }}</span>
                                                {% endif %}
                                            {% else %}
                                                {{ course }}
                                            {% endif %}
                                        </div>
                                        {% endfor %}
                                    </div>
                                </div>
                                {% endif %}
                                
                                {% if recommendation.skills_to_develop %}
                                <div class="mb-3">
                                    <h6 class="text-secondary">Skills to Develop</h6>
                                    <div class="row">
                                        {% for skill in recommendation.skills_to_develop %}
                                        <div class="col-md-6 mb-2">
                                            <div class="card border-0 bg-light">
                                                <div class="card-body py-2">
                                                    <i class="fas fa-check-circle text-success me-2"></i>
                                                    {% if skill.skill %}
                                                        <strong>{{ skill.skill }}</strong>
                                                        {% if skill.importance %}
                                                            <span class="badge bg-primary ms-2">{{ skill.importance }}</span>
                                                        {% endif %}
                                                    {% else %}
                                                        {{ skill }}
                                                    {% endif %}
                                                </div>
                                            </div>
                                        </div>
                                        {% endfor %}
                                    </div>
                                </div>
                                {% endif %}
                                
                                {% if recommendation.additional_recommendations %}
                                <div class="mb-3">
                                    <h6 class="text-secondary">Additional Recommendations</h6>
                                    <div class="alert alert-info">
                                        <p class="mb-0">{{ recommendation.additional_recommendations }}</p>
                                    </div>
                                </div>
                                {% endif %}
                            </div>
                            
                            <div class="recommendation-actions mt-3">
                                <button class="btn btn-sm btn-outline-primary" onclick="viewFullRecommendation({{ recommendation.id }})">
                                    <i class="fas fa-eye me-1"></i>View Full Details
                                </button>
                                <button class="btn btn-sm btn-outline-success" onclick="regenerateRecommendation({{ student.id }}, {{ recommendation.id }})">
                                    <i class="fas fa-redo me-1"></i>Regenerate
                                </button>
                                <button class="btn btn-sm btn-outline-info" onclick="exportRecommendation({{ recommendation.id }})">
                                    <i class="fas fa-download me-1"></i>Export
                                </button>
                            </div>
                        </div>
                        
                        {% if not loop.last %}
                        <hr>
                        {% endif %}
                        {% endfor %}
                    </div>
                    {% else %}
                    <div class="text-center py-5">
                        <i class="fas fa-robot text-muted fs-1 mb-3"></i>
                        <h5 class="text-muted">No Recommendations Yet</h5>
                        <p class="text-muted">This student hasn't received any AI recommendations yet.</p>
                        <button class="btn btn-primary" onclick="generateRecommendation({{ student.id }})">
                            <i class="fas fa-magic me-2"></i>Generate Recommendation
                        </button>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function refreshPage() {
    location.reload();
}

function viewFullRecommendation(recommendationId) {
    // This would open a modal or redirect to a detailed view
    alert(`View full recommendation ${recommendationId} - Feature coming soon!`);
}

function regenerateRecommendation(studentId, recommendationId) {
    if (confirm('Are you sure you want to regenerate this recommendation? This will create a new recommendation based on the latest AI models.')) {
        // This would call an API to regenerate the recommendation
        alert(`Regenerating recommendation for student ${studentId} - Feature coming soon!`);
    }
}

function exportRecommendation(recommendationId) {
    // This would export the recommendation as PDF or other format
    alert(`Exporting recommendation ${recommendationId} - Feature coming soon!`);
}

function generateRecommendation(studentId) {
    if (confirm('Generate a new AI recommendation for this student?')) {
        // This would redirect to the recommendation form with pre-filled data
        window.location.href = `/recommendation-form?student_id=${studentId}`;
    }
}
</script>

<style>
.avatar-lg {
    width: 80px;
    height: 80px;
    font-size: 2rem;
    font-weight: 600;
}

.student-info .info-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.5rem 0;
    border-bottom: 1px solid #f8f9fa;
}

.student-info .info-item:last-child {
    border-bottom: none;
}

.performance-chart .score-item {
    margin-bottom: 1rem;
}

.performance-chart .score-item:last-child {
    margin-bottom: 0;
}

.interests-container {
    display: flex;
    flex-wrap: wrap;
    gap: 0.25rem;
}

.recommendation-item {
    padding: 1rem;
    border: 1px solid #e9ecef;
    border-radius: 0.375rem;
    background-color: #f8f9fa;
}

.recommendation-actions {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
}

.card {
    box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
    border: 1px solid rgba(0, 0, 0, 0.125);
}

.progress {
    height: 0.5rem;
}

.badge {
    font-size: 0.75em;
}

.list-group-item {
    border-radius: 0.375rem;
}

.alert {
    border-radius: 0.375rem;
}
</style>
{% endblock %}
